apiVersion: traefik.io/v1alpha1
kind: IngressRouteTCP
metadata:
  name: postgresql
spec:
  entryPoints:
    # IMPORTANT: Requires 'postgres' TCP entrypoint on port 5432 in Traefik!
    # If missing, add to Traefik: ports.postgres.port=5432 ports.postgres.protocol=TCP
    # Also ensure firewall/security group allows inbound TCP on port 5432
    - postgres
  routes:
    - match: HostSNI(`placeholder.dockify.cloud`)
      services:
        - name: postgresql
          port: 5432
  # TLS required for SNI routing to work!
  tls:
    # TLS termination - Traefik handles TLS with wildcard cert
    # PostgreSQL receives unencrypted traffic from Traefik
    secretName: wildcard-dockify-cloud-tls
    domains:
      - main: placeholder.dockify.cloud
