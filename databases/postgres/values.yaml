# Deployment info
namespace: ""          # Required - project UUID
name: "postgres"       # Deployment name

# Image
image: postgres
tag: "16.3"

# Database credentials
database:
  name: postgres
  username: postgres
  password: ""         # Required - generated at deploy

# Resources (from plan)
resources:
  requests:
    cpu: "250m"
    memory: "512Mi"
  limits:
    cpu: "500m"
    memory: "1Gi"

# Storage
storage:
  size: "10Gi"
  storageClass: ""     # Uses default if empty

# Network
service:
  type: NodePort
  port: 5432
  nodePort: 30432      # Required - allocated by API

# Resource Quota & Limits (namespace level)
# Disabled by default - allows multiple deployments per namespace
quota:
  enabled: false

# Health checks
healthCheck:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10

# PostgreSQL Extensions (built-in, auto-enabled at first boot)
# These run via /docker-entrypoint-initdb.d/ only on fresh databases
extensions:
  enabled: true
  list:
    - pg_stat_statements  # Performance monitoring & query stats
    - pg_trgm             # Fuzzy text search, autocomplete
    - pgcrypto            # Cryptographic functions
    - citext              # Case-insensitive text type
    - unaccent            # Remove accents for search (diacritics)

# Logging configuration
# log_min_messages controls which message levels are sent to the server log
# Valid values: debug, info, notice, warning, error, log, fatal, panic
logging:
  minMessages: "warning"    # Default: warnings and above

# PgBouncer - Connection Pooler (sidecar)
pgbouncer:
  enabled: false
  image: edoburu/pgbouncer
  tag: "v1.24.1-p1"
  port: 6432                    # Internal PgBouncer port
  nodePort: 30433               # External NodePort for PgBouncer
  poolMode: transaction         # transaction | session | statement
  maxClientConn: 100            # Max client connections
  defaultPoolSize: 20           # Connections per user/database pair
  minPoolSize: 5                # Min connections to keep open
  reservePoolSize: 5            # Extra connections for burst
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "200m"
      memory: "128Mi"
