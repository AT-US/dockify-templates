# Loki Helm Chart Values
# This chart deploys Grafana Loki with Cloudflare Tunnel exposure
#
# Loki is a log aggregation system designed to store and query logs
# from all your applications and infrastructure.

namespace: ""
name: ""

image: grafana/loki
tag: "3.0.0"

# Infisical integration - secrets sync from Infisical (source of truth)
# When enabled, InfisicalSecret CRD creates K8s Secret automatically
infisical:
  enabled: false
  hostAPI: "https://vault.dockify.app/api"
  projectId: ""           # Organization's Infisical project UUID
  environment: "dev"      # Infisical environment slug
  secretPath: ""          # Path in Infisical (e.g., /loki/deployment-name)
  resyncInterval: 15      # Sync every 15 seconds
  credentialsSecretName: "infisical-machine-identity"
  credentialsNamespace: "infisical-system"

# Resource allocation
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 2000m
    memory: 2Gi

# Persistent storage for logs
storage:
  size: 10Gi
  storageClass: ""  # Uses default if empty

# Cloudflare Tunnel configuration
tunnel:
  enabled: true
  fqdn: ""  # e.g., myapp-loki.dockify.cloud
  clusterTunnel: s1-dockify-cloud-tunnel

# Internal service (ClusterIP)
service:
  type: ClusterIP
  port: 3100

# Pod Disruption Budget
pdb:
  enabled: true
  minAvailable: 0  # Allow drain for single replica deployments

# Loki configuration
config:
  # Authentication (basic auth)
  auth:
    enabled: false
    # Credentials stored in Infisical secret when enabled

  # Retention period for logs
  retention:
    enabled: true
    period: 744h  # 31 days

  # Limits
  limits:
    ingestionRate: 4MB
    ingestionBurstSize: 6MB
    maxStreamsPerUser: 10000
    maxEntriesLimitPerQuery: 5000
